# tpm plugin installation
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'hallazzang/tmux-reset'
set -g @plugin 'catppuccin/tmux'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugin/tmux-continuum'
set -g @plugin 'pschmitt/tmux-ssh-split'


set -g default-terminal "screen-256color"
set -g mouse on
setw -g automatic-rename on
set -g @continuum-restore 'on'
set-option -g allow-passthrough on

{{ if eq .chezmoi.os "darwin" -}}
# rebind the prefix to C-SPACE on macOS
unbind C-b
set -g prefix C-Space
bind-key C-Space send-prefix
{{ else -}}
# keep default C-b prefix on Linux
{{ end -}}

# yellow border around active window
set -g @catppuccin_pane_border_style "fg=#6c7086"
set -g @catppuccin_pane_active_border_style "fg=#f9e2af"
set -g @catppuccin_pane_status_enabled "yes"
set -g @catppuccin_pane_border_status "top"

# add padding around tmux windows
set -g status-left-length 050
set -g status-right-length 050
set -g status-position bottom
set -g status-justify centre
set -g pane-border-lines heavy

# ensure complete yellow border visibility
set -g pane-border-status top
set -g pane-border-format " "
set -g pane-active-border-style "fg=#f9e2af"
set -g pane-border-style "fg=#6c7086"

## status config
set-option -g status-interval 1
set-option -g status-right "%Y-%m-%d %H:%M:%S"


# create outer border effect with status bar
set -g status-style "bg=#f9e2af"
set -g window-status-separator ""
set -g window-status-format "#I:#W"
set -g window-status-current-format "#[fg=green]#I:#W"

# reload config shortcut
unbind r
bind r source-file ~/.config/tmux/tmux.conf

# SSH split configuration - preserve both SSH sessions and working directories
set-option -g @ssh-split-keep-cwd "true"           # Preserve local working directory  
set-option -g @ssh-split-keep-remote-cwd "true"    # Preserve remote working directory
set-option -g @ssh-split-strip-cmd "true"          # Clean SSH commands
set-option -g @ssh-split-no-shell "false"          # Keep shell sessions

# Unbind default split keys
unbind '"'
unbind %

# Rebind default keys to use SSH-aware splits with directory preservation
bind '"' if-shell '[ -n "$SSH_CLIENT" ] || [ -n "$SSH_TTY" ]' \
    'run-shell "~/.tmux/plugins/tmux-ssh-split/scripts/tmux-ssh-split -v"' \
    'split-window -c "#{pane_current_path}"'
bind % if-shell '[ -n "$SSH_CLIENT" ] || [ -n "$SSH_TTY" ]' \
    'run-shell "~/.tmux/plugins/tmux-ssh-split/scripts/tmux-ssh-split -h"' \
    'split-window -h -c "#{pane_current_path}"'

# Additional bindings for SSH-aware splits  
set-option -g @ssh-split-h-key "|"                 # Alternative horizontal split
set-option -g @ssh-split-v-key "-"                 # Alternative vertical split

# dynamic pane resizing
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r h resize-pane -L 5

# fill pane to full screen
bind -r ENTER resize-pane -Z

bind S command-prompt -p "New session name:" "new-session -s '%%'":w
bind W command-prompt -p "New window name:" "new-window -n '%%'":w

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
